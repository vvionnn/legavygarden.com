{% extends "base.html" %}

{% block title %}Profile | The Legacy Garden{% endblock %}

{% block content %}
<style>
/* ===== PROFILE ===== */
.profile-wrapper {
    background-color: #f8f5f0;
    min-height: 100vh;
    padding-top: 20px;
    padding-bottom: 120px;
}

.profile-pic{
  width: clamp(140px, 14vw, 220px);   /* bigger range */
  height: clamp(140px, 14vw, 220px);
  object-fit: cover;
  background-color: #E8F0EA;
  border: clamp(3px, 0.6vw, 2px) solid #000;  /* responsive border */
}


/* Buttons */
.btn-legacy-dark {
    background-color: #1B7A4B;
    color: white !important;
    border: none !important;
    padding: 10px 30px !important;
    border-radius: 6px !important;
    font-weight: 600;
}

.btn-legacy-dark:hover {
    filter: brightness(1.2);
    color: white !important;
}

.mr-3 { margin-right: 1rem !important; }

.rewards-btn {
    background-color: #1B7A4B;
    color: white !important;
    border-radius: 8px;
    font-weight: 600;
}

.rewards-btn:hover {
    filter: brightness(1.1);
    transform: translateY(-2px);
}

/* Profile Card */
.profile-card-bg {
    background-color: #ffffff;
    border-radius: 20px;
    padding: 20px;
}

/* Stories */
.story-card {
    border-radius: 16px;
    background: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    padding: 25px;
    margin-bottom: 25px;
}

/* Floating Button */
.create-story-btn {
    position: fixed;
    bottom: 40px;
    right: 40px;
    background-color: #1B7A4B;
    color: white !important;
    padding: 12px 28px;
    border-radius: 50px;
    font-weight: 700;
    text-decoration: none !important;
    display: flex;
    align-items: center;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    z-index: 9999;
}

.create-story-btn:hover {
    transform: scale(1.05);
}

.story-thumb{
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 12px;
    background: #E8F0EA;
}
.story-image-left{
  width: 220px;
  flex-shrink: 0;
}

.story-image-left .story-thumb{
  height: 100%;
  min-height: 160px;
  width: 100%;
  object-fit: cover;
  border-radius: 12px;
}

.story-content-right{
  padding-left: 20px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
/* Make My Rewards responsive */
@media (max-width: 768px){
  /* center everything inside the profile card */
  .profile-card-bg,
  .profile-card-bg *{
    text-align: center !important;
  }

  /* center the buttons row (Edit/Settings) */
  .profile-card-bg .d-flex{
    justify-content: center !important;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 22px;
  }

  /* make buttons look consistent on mobile */
  .profile-card-bg .btn{
    display: inline-flex;
    justify-content: center;
    align-items: center;
  }

  /* center + full width My Rewards nicely */
  .profile-card-bg .rewards-btn{
    display: inline-flex;
    justify-content: center;
    width: 100%;
    max-width: 420px;
    margin-top: 18px;
  }
  /* spacing under profile image */
  .profile-pic{
    margin-bottom: 22px;
  }

  /* spacing between name and username */
  .profile-card-bg h2{
    margin-bottom: 6px;
  }

  .profile-card-bg .text-muted{
    margin-bottom: 14px;
  }

  /* spacing between profile info lines */
  .profile-card-bg p{
    margin-bottom: 12px;
  }
}

/* ===== PROFILE RESPONSIVE WIDTH (LIKE HOME) ===== */
.profile-inner {
  max-width: 1100px;     /* desktop */
  margin-left: auto;
  margin-right: auto;
}

@media (max-width: 1200px){
  .profile-inner { max-width: 960px; }
}

@media (max-width: 992px){
  .profile-inner { max-width: 720px; }
}

@media (max-width: 768px){
  .profile-inner { max-width: 540px; }
}

@media (max-width: 576px){
  .profile-inner { 
    max-width: 100%;
    padding-left: 16px;
    padding-right: 16px;
  }
}


</style>

<div class="profile-wrapper">

    <!-- Flash Messages -->
    <div class="container mt-3">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-success shadow-sm"
                         style="background-color:#31513c;color:white;border:none;border-radius:12px;">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- PROFILE CARD -->
    <div class="container mt-4">
        <div class="profile-inner profile-card-bg shadow-sm">

            <div class="row align-items-center p-4">

                <div class="col-md-3 text-center">
                    {% if profile['profile_pic'] and profile['profile_pic'] != 'profile_pic.png' %}
                        <img src="{{ url_for('static', filename='uploads/' + profile['profile_pic']) }}"
                            class="rounded-circle shadow-sm profile-pic">
                    {% else %}
                        <img src="https://ui-avatars.com/api/?name={{ profile['name'] or session['username'] }}&background=random&size=150"
                            class="rounded-circle shadow-sm profile-pic">
                    {% endif %}
                </div>

                <div class="col-md-6">
                    <h2 class="font-weight-bold mb-0">{{ session['username'] }}</h2>
                    <p class="text-muted mb-3">{{ profile['name'] }}</p>

                    <p class="mb-1">
                        <strong>Profile type:</strong> {{ session['role'] }}
                        {% if profile['show_region'] %}
                            &nbsp;&nbsp;<strong>Region:</strong> {{ profile['region'] }}
                        {% endif %}
                    </p>

                    {% if profile['show_email'] %}
                        <p class="text-muted">
                            <i class="fa-regular fa-envelope"></i> {{ profile['email'] }}
                        </p>
                    {% endif %}

                    <p class="mt-3" style="max-width:500px;">
                        <strong>Bio:</strong><br>
                        {{ profile['bio'] if profile['bio'] else 'Tell us about your love for gardening!' }}
                    </p>

        <div class="mt-4 d-flex">
                        <a href="{{ url_for('edit_profile') }}" class="btn btn-legacy-dark mr-3">Edit profile</a>
                        <a href="{{ url_for('settings') }}" class="btn btn-legacy-dark">Settings</a>
                    </div>
                </div>

                <div class="col-md-3 text-right align-self-start">
                    <a href="{{ url_for('mygarden') }}" class="btn rewards-btn px-4">My Rewards</a>
                </div>
            </div>
        </div>
    </div>

    
    <div class="container">
        <div class="profile-inner">
            <hr class="my-5">
        </div>   
    </div>

    <!-- MY STORIES -->
    <div class="container">
        <div class="profile-inner">
            <h4 class="fw-bold mb-4">My Stories</h4>

            {% if stories and stories|length > 0 %}
                {% for story in stories %}
                <div class="story-card d-flex align-items-stretch">

                    <!-- LEFT: Image -->
                    <div class="story-image-left">
                    {% set img = (story.image_path or '')|trim %}
                    <img
                        src="{% if img %}
                                {{ url_for('static', filename='uploads/' + img) }}
                            {% else %}
                                {{ url_for('static', filename='uploads/logo.jpeg') }}
                            {% endif %}"
                        class="story-thumb"
                        alt="{{ story.title }}">
                    </div>

                    <!-- RIGHT: Content -->
                    <div class="story-content-right">
                    <h5 class="mb-2">{{ story['title'] }}</h5>
                    <p class="text-muted mb-3">
                        {{ story['content'][:180] }}{% if story['content']|length > 180 %}...{% endif %}
                    </p>

                    <a href="{{ url_for('story.view_story', story_id=story['id']) }}"
                        style="color:#2D8A5B;font-weight:600;">
                        Read more â†’
                    </a>
                    </div>

                </div>
                {% endfor %}
            {% else %}
            <div class="text-muted">You havenâ€™t shared any stories yet ðŸŒ±</div>
            {% endif %}
        </div>
    </div>

    <!-- Floating Button -->
    <a href="{{ url_for('story.create') }}" class="create-story-btn">
        <span style="font-size:24px;margin-right:10px;">+</span>
        Create Story
    </a>

</div>
{% endblock %}